<template lang='pug'>
  div
    div.cu(style='overflow-y: auto')
      table.table.is-striped._cred(align='center')
        thead
          tr
            td: strong FOOD
            td: strong รวม
            td.mcenter(v-for='group in Object.keys(meals)' :key='group')
              div(align="center"): strong {{group}}
        tbody
          tr(v-for='field in fields' :key='field')
            td: strong {{ translate(field) || field  }}
            td: div(align="center") {{total[field]}}
            td.mcenter(v-for='meal in meals' :key='meal + field')
              div(align="center") {{meal[field]}}
</template>

<script>
import _ from 'lodash';
import { MealService } from '@/common/api.service';
import translate from '@/other/language_translate.json';
export default {
	props: ['group'],
	data() {
		return {
			meals: {}
		};
	},
	async created() {
		this.meals =
			(this.group == 'staff'
				? await MealService.getStaffMeals()
				: await MealService.getMeals()
			).data || [];
	},
	methods: {
		translate(word) {
			return translate[word];
		},
		sum(property) {
			return _.values(this.meals).reduce((a, b) => a + b[property], 0);
		}
	},
	computed: {
		fields() {
			console.log('test');
			return Object.keys(Object.values(this.meals)[0] || {});
		},
		total() {
			return {
				normal: this.sum('normal'),
				islamic: this.sum('islamic'),
				veg: this.sum('veg'),
				total: this.sum('total')
			};
		}
	}
};
</script>

<style scoped>
td {
	padding: 0.3em 0.4em;
}
</style>
